
## 13-1 AWS S3 (íŒŒì¼ ìŠ¤í† ë¦¬ì§€ ì…‹ì—…)

### 1. ì˜¤í”„ë‹

ì•ˆë…•í•˜ì„¸ìš”, ì—¬ëŸ¬ë¶„. ìš°ë¦¬ëŠ” 11ì°¨ì‹œ 'ê°•ì˜ ë§Œì¡±ë„ ì•±' ê¸°íšê³¼ Supabase ë°±ì—”ë“œ ì…‹ì—…ë¶€í„° ì‹œì‘í•´ì„œ, 12ì°¨ì‹œì—ëŠ” Vercelê³¼ GitHub Pagesë¥¼ ì´ìš©í•œ **í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬**ë¥¼ ê²½í—˜í•˜ê³  ì‹¤ìŠµ ê³¼ì œê¹Œì§€ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

ì´ì œ 13ì°¨ì‹œì— ì´ë¥´ëŸ¬, ì´ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ë¡œ ë¬¶ëŠ” **'ì™„ì „ì²´'** ì‹œë‚˜ë¦¬ì˜¤ì˜ ë§ˆì§€ë§‰ ì¡°ê°ì„ ë§ì¶œ ì‹œê°„ì…ë‹ˆë‹¤.
n8nì—ì„œ ì²˜ë¦¬í•˜ê¸° í˜ë“  'ë¬´ê±°ìš´ ì‘ì—…'(e.g., ëŒ€ìš©ëŸ‰ PDF ìƒì„±)ì„ ìˆ˜í–‰íˆ í•„ìš”í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤. 

13ì°¨ì‹œì—ì„œëŠ” ë°”ë¡œ ì´ **'ë¬´ê±°ìš´ ì‘ì—…'ì„ ì „ë‹´í•  ë³„ë„ì˜ ë°±ì—”ë“œ ì„œë²„**ë¥¼ êµ¬ì¶•í•˜ê³ , 11ì°¨ì‹œì˜ n8n ì›Œí¬í”Œë¡œìš°ì™€ ì—°ë™í•˜ëŠ” ê³¼ì •ì„ ê²½í—˜í•  ê²ƒì…ë‹ˆë‹¤.

ì´ **ë°±ì—”ë“œ ë°°í¬** ê²½í—˜ì€ 11, 12ì°¨ì‹œì˜ ì§€ì‹ì„ í•˜ë‚˜ë¡œ í†µí•©í•˜ì—¬ ì—¬ëŸ¬ë¶„ì´ ìë™í™” ì‹œìŠ¤í…œì„ ì‘ìš©í•˜ëŠ” ìˆ˜ì¤€ì„ í•œ ë‹¨ê³„ ë†’ì—¬ì£¼ê³ , ì•ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ì¼ì˜ ë²”ìœ„ë¥¼ í›¨ì”¬ ë” ë„“í˜€ì£¼ëŠ” ì¤‘ìš”í•œ ì˜ë¯¸ê°€ ìˆìŠµë‹ˆë‹¤.

ê·¸ ì²« ë‹¨ê³„ë¡œ, ìš°ë¦¬ ë°±ì—”ë“œ ì„œë²„ê°€ ìƒì„±í•  PDF ê°™ì€ ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì €ì¥í•  **ì˜êµ¬ì ì¸ íŒŒì¼ ìŠ¤í† ë¦¬ì§€**ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ë„¤, ìš”ì²­í•˜ì‹ ëŒ€ë¡œ 'êµ¬ê¸€ ë“œë¼ì´ë¸Œ' ëŒ€ì‹  'AWS S3'ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¥¼ ë³´ê°•í•˜ê³ , ê¸°ì¡´ ë‚´ìš©ì„ ë‹¤ë“¬ì–´ 13-1ì˜ 2ë²ˆ, 3ë²ˆ í•­ëª©ì„ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.

---

### 2. ì™œ API ì‘ë‹µìœ¼ë¡œ íŒŒì¼ì„ ë³´ë‚´ë©´ ì•ˆ ë˜ëŠ”ê°€? (feat. S3 vs Google Drive)

* **ë¹„íš¨ìœ¨ ë° íƒ€ì„ì•„ì›ƒ:** 5MBì§œë¦¬ PDFë¥¼ ìƒì„±í•´ API ì‘ë‹µ ë³¸ë¬¸(Body)ì— ì‹¤ì–´ n8nìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤. íŒŒì¼ì´ 30MB, 100MBê°€ ë˜ë©´ HTTP ì‘ë‹µ ì‹œê°„ ì œí•œ(e.g., 60ì´ˆ)ì— ê±¸ë ¤ n8nì´ íŒŒì¼ì„ ë°›ê¸°ë„ ì „ì— ì—°ê²°ì´ ëŠì–´ì§‘ë‹ˆë‹¤.

* **íŒŒì¼ ìŠ¤í† ë¦¬ì§€ì˜ í•„ìš”ì„±:** ë”°ë¼ì„œ ì„œë²„ëŠ” ìƒì„±ëœ íŒŒì¼ì„ APIë¡œ ì§ì ‘ ë°˜í™˜í•˜ëŠ” ëŒ€ì‹ , ì–´ë”˜ê°€ì— 'ì˜êµ¬ì ì¸ íŒŒì¼ ìŠ¤í† ë¦¬ì§€'ì— ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.

* **ì™œ Google Driveê°€ ì•„ë‹Œ AWS S3ì¸ê°€?**
    * **ëª©ì ì˜ ì°¨ì´:** êµ¬ê¸€ ë“œë¼ì´ë¸ŒëŠ” **'ì‚¬ìš©ì'** ì¤‘ì‹¬ì˜ íŒŒì¼ ê³µìœ /í˜‘ì—… ë„êµ¬ì…ë‹ˆë‹¤. ë°˜ë©´ **AWS S3**ëŠ” **'ì• í”Œë¦¬ì¼€ì´ì…˜(ë°±ì—”ë“œ ì„œë²„)'**ì´ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ì›¹ì— ì§ì ‘ ì œê³µ(ì„œë¹™)í•˜ë„ë¡ ì„¤ê³„ëœ **ê°ì²´ ìŠ¤í† ë¦¬ì§€**ì…ë‹ˆë‹¤.
    * **ì ‘ê·¼ ë°©ì‹:** ìš°ë¦¬ ë°±ì—”ë“œ ì„œë²„(Node.js)ê°€ êµ¬ê¸€ ë“œë¼ì´ë¸Œì— íŒŒì¼ì„ ì˜¬ë¦¬ë ¤ë©´, ë³µì¡í•œ ì‚¬ìš©ì ì¸ì¦(OAuth 2.0) ê³¼ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ S3ëŠ” ì„œë²„ ì „ìš© SDK(`@aws-sdk/client-s3`)ì™€ API í‚¤ë¥¼ í†µí•´ í›¨ì”¬ ê°„ê²°í•˜ê³  ì•ˆì •ì ìœ¼ë¡œ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    * **ì›¹ í˜¸ìŠ¤íŒ…:** S3ëŠ” ê·¸ ìì²´ë¡œ íŒŒì¼ í˜¸ìŠ¤íŒ… ì„œë²„(CDNì²˜ëŸ¼) ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ë° ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ë“œë¼ì´ë¸ŒëŠ” 'ê³µìœ 'ê°€ ëª©ì ì´ë¼, ë§í¬ë¥¼ ëˆŒë €ì„ ë•Œ íŒŒì¼ì´ ë°”ë¡œ ë‹¤ìš´ë¡œë“œë˜ì§€ ì•Šê³  êµ¬ê¸€ì˜ ë¯¸ë¦¬ë³´ê¸° í™”ë©´ì´ ë¨¼ì € ëœ¨ëŠ” ë“± ì• í”Œë¦¬ì¼€ì´ì…˜ ì—°ë™ìš©ìœ¼ë¡œëŠ” ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

* **ì •ë‹µ:** ì„œë²„ëŠ” ìƒì„±ëœ íŒŒì¼ì„ **AWS S3** ê°™ì€ **'ê°ì²´ ìŠ¤í† ë¦¬ì§€'**ì— ì €ì¥í•˜ê³ , n8nì—ëŠ” "ì €ì¥ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤"ë¼ëŠ” **íŒŒì¼ì˜ ì£¼ì†Œ(URL) ë˜ëŠ” í‚¤(Key)**ë§Œ ì¦‰ì‹œ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.

---

### 3. AWS S3 (Simple Storage Service)ë€?

AWSì—ì„œ ì œê³µí•˜ëŠ” **ê°ì²´ ìŠ¤í† ë¦¬ì§€(Object Storage) ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ì¸í„°ë„·ì„ ìœ„í•œ ê±°ëŒ€í•œ 'íŒŒì¼ ì°½ê³ 'ë¼ê³  ìƒê°í•˜ë©´ ì‰½ìŠµë‹ˆë‹¤. GCP ì—ì„œëŠ” GCS(Google Cloud Storage)ê°€ ìˆê³  ê° í´ë¼ìš°ë“œ ë§ˆë‹¤ ìŠ¤í† ë¦¬ì§€ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ìš°ë¦¬ëŠ” ëŒ€í‘œ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ì¸ AWS S3ë¥¼ ì²´í—˜ í•´ë³´ê² ìŠµë‹ˆë‹¤. 

ìš°ë¦¬ ë°±ì—”ë“œ ì„œë²„ê°€ ìƒì„±í•œ PDF, ì‚¬ìš©ì ì´ë¯¸ì§€, ë™ì˜ìƒ, ë¡œê·¸ ë°ì´í„° ë“± **ëª¨ë“  ì¢…ë¥˜ì˜ ì •ì  íŒŒì¼**ì„ ì €ì¥í•˜ê³ , APIë‚˜ SDKë¥¼ í†µí•´ ì „ ì„¸ê³„ ì–´ë””ì„œë‚˜ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ë†’ì€ ë‚´êµ¬ì„±ê³¼ í™•ì¥ì„±ì„ ì œê³µí•˜ì—¬ ê°œë°œìë“¤ì´ ê°€ì¥ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” í•µì‹¬ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

### 4\. S3 ì…‹ì—… ì‹¤ìŠµ

1.  **ë²„í‚·(Bucket) ìƒì„±:**

      * AWSì— ë¡œê·¸ì¸ í›„ S3 ì„œë¹„ìŠ¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.
      * 'ë²„í‚· ë§Œë“¤ê¸°'ë¥¼ í´ë¦­í•˜ê³ , ì „ ì„¸ê³„ì—ì„œ ìœ ì¼í•œ ì´ë¦„(e.g., `n8n-reports-pdf-myname`)ì„ ì…ë ¥í•©ë‹ˆë‹¤.
      * ë¦¬ì „(Region)ì€ `ap-northeast-2` (ì„œìš¸)ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
      * "ëª¨ë“  í¼ë¸”ë¦­ ì•¡ì„¸ìŠ¤ ì°¨ë‹¨"ì„ (ê¸°ë³¸ê°’) ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
	      * n8nì˜ `AWS S3` ë…¸ë“œê°€ IAM í‚¤ë¥¼ ì‚¬ìš©í•´ **ì§ì ‘** íŒŒì¼ì— ì ‘ê·¼í•˜ë¯€ë¡œ, ë²„í‚·ì„ ì™¸ë¶€ì— ê³µê°œí•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì´ê²ƒì´ ì•ˆì „í•œ ë°©ì‹ì…ë‹ˆë‹¤.
      * ë²„í‚·ì„ ìƒì„±í•©ë‹ˆë‹¤.

2.  **IAM ì‚¬ìš©ì ìƒì„± (API ì ‘ê·¼ í‚¤ ë°œê¸‰):**

      * ìš°ë¦¬ ë°±ì—”ë“œ ì„œë²„(Node.js) **ë° n8n ì›Œí¬í”Œë¡œìš°**ê°€ S3ì— ì ‘ê·¼í•˜ë ¤ë©´ 'ì¸ì¦'ì´ í•„ìš”í•©ë‹ˆë‹¤.
      * IAM ì„œë¹„ìŠ¤ë¡œ ì´ë™ \> 'ì‚¬ìš©ì' \> 'ì‚¬ìš©ì ìƒì„±'ì„ í´ë¦­í•©ë‹ˆë‹¤.
      * ì‚¬ìš©ì ì´ë¦„(e.g., `n8n-s3-access`)ì„ ì…ë ¥í•©ë‹ˆë‹¤.
      * 'í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤'ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
      * ê¶Œí•œ ì„¤ì •ì—ì„œ 'ê¸°ì¡´ ì •ì±… ì§ì ‘ ì—°ê²°' \> `AmazonS3FullAccess`ë¥¼ ê²€ìƒ‰í•˜ì—¬ ì„ íƒí•©ë‹ˆë‹¤. (ì‹¤ë¬´ì—ì„œëŠ” ë” ì„¸ë°€í•œ ê¶Œí•œì„ ì¤˜ì•¼ í•©ë‹ˆë‹¤)
      * ì‚¬ìš©ì ìƒì„±ì„ ì™„ë£Œí•˜ë©´ **`ì•¡ì„¸ìŠ¤ í‚¤ ID` (Access Key ID)** ì™€ **`ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤` (Secret Access Key)** ë¥¼ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
      * **[ì¤‘ìš”]** ì´ ë‘ ê°œì˜ í‚¤ëŠ” **1) ë°±ì—”ë“œ ì„œë²„(13-2)ì˜ í™˜ê²½ ë³€ìˆ˜**ì´ì, **2) n8nì˜ AWS Credentials**ë¡œ ë‘˜ ë‹¤ ì‚¬ìš©ë©ë‹ˆë‹¤. ë°˜ë“œì‹œ ì•ˆì „í•œ ê³³ì— ë³µì‚¬í•´ ë‘¡ë‹ˆë‹¤.
      * ì„¸ë°€ ì œì–´ policy ì˜ˆì‹œ
  ```
  {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetBucketLocation"
            ],
            "Resource": "arn:aws:s3:::n8n-reports-pdf-myname"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject",
                "s3:PutObjectAcl"
            ],
            "Resource": "arn:aws:s3:::n8n-reports-pdf-myname/*"
        }
    ]
}
  ```

3.  **Claude Code ì´ìš© ì„¸ë°€ ì œì–´:**

      * AWS CLI ì„¤ì¹˜ ë° ìœ ì € ê¶Œí•œ ì„¤ì • í•„ìš”
	      * ì…‹ì—… ë°©ë²• ë³„ë„ ë…¸íŠ¸ ì œê³µ ì˜ˆì •
      * s3 ë²„í‚· ìƒì„± ë° ê´€ë ¨ ë²„í‚·ë§Œ ì—‘ì„¸ìŠ¤ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • ìš”ì²­í•¨ 

-----

## 13-2 ë°±ì—”ë“œ ë¡œì§ê³¼ n8n ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°

### 1\. ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ (n8n + Backend)

13ì°¨ì‹œì˜ ìµœì¢… ëª©í‘œ ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤.

1.  **(n8n)** `Schedule` ë…¸ë“œê°€ ë§¤ì£¼ ê¸ˆìš”ì¼ 17ì‹œì— ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2.  **(n8n)** `Supabase` ë…¸ë“œê°€ 11ì°¨ì‹œ DBì˜ `get_dashboard_stats` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ í†µê³„ JSONì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
3.  **(n8n)** `Set` ë…¸ë“œê°€ ì´ í†µê³„ JSONì„ 4ë²ˆì´ ì•Œì•„ë“£ê¸° ì‰½ê²Œ ê°€ê³µí•©ë‹ˆë‹¤.
4.  **(n8n)** `HTTP Request` ë…¸ë“œê°€ ê°€ê³µëœ JSONì„ ìš°ë¦¬ ë°±ì—”ë“œ API (`POST /generate`)ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
5.  **(Backend)** `Puppeteer`ê°€ PDFë¥¼ ìƒì„±í•˜ê³ , `aws-sdk`ê°€ ì´ PDFë¥¼ 13-1ì˜ **ë¹„ê³µê°œ S3 ë²„í‚·**ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.
6.  **(Backend)** S3ì— ì €ì¥ëœ **íŒŒì¼ì˜ í‚¤(ê²½ë¡œ)** (e.g., `reports/report-uuid.pdf`)ë¥¼ n8nì— **ì¦‰ì‹œ JSONìœ¼ë¡œ ì‘ë‹µ**í•©ë‹ˆë‹¤.
7.  **(n8n)** `AWS S3` ë…¸ë“œê°€ 6ë²ˆì—ì„œ ë°›ì€ íŒŒì¼ í‚¤(Key)ë¥¼ ì‚¬ìš©í•´, í•´ë‹¹ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” \*\*ì„ì‹œ ë³´ì•ˆ URL (Pre-signed URL)**ì„ ìƒì„±í•©ë‹ˆë‹¤.**
8.  **(n8n)** `Telegram` ë…¸ë“œê°€ ì´ **Pre-signed URL**ì„ ë°›ì•„ ê´€ë¦¬ìì—ê²Œ ì „ì†¡í•©ë‹ˆë‹¤.

### 2\. n8n ë°ì´í„° í•©ì„± (Set ë…¸ë“œ)

n8n `Set` ë…¸ë“œëŠ” Supabaseì˜ ì›ë³¸ ë°ì´í„°ë¥¼ ë°±ì—”ë“œ APIê°€ ì›í•˜ëŠ” ìµœì¢… JSONìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•©ë‹ˆë‹¤.

\<details\>
\<summary\>\<b\>(ì°¸ê³ ) 1. Supabase ì›ë³¸ ë°ì´í„° (Supabase ë…¸ë“œ ê²°ê³¼)\</b\>\</summary\>

```json
[
  {
    "nps_score": 71.4285714285714,
    "total_respondents": 308,
    "position_distribution": [
      {
        "count": 112,
        "position": "ê°œë°œì"
      },
      {
        "count": 75,
        "position": "ë§¤ë‹ˆì €"
      },
      {
        "count": 65,
        "position": "ê¸°íƒ€"
      },
      {
        "count": 56,
        "position": "ì„ì›"
      }
    ],
    "company_size_distribution": [
      {
        "count": 91,
        "company_size": "51-200ëª…"
      },
      {
        "count": 85,
        "company_size": "201ëª… ì´ìƒ"
      },
      {
        "count": 68,
        "company_size": "11-50ëª…"
      },
      {
        "count": 64,
        "company_size": "1-10ëª…"
      }
    ]
  }
]
```

\</details\>

\<details\>
\<summary\>\<b\>âœ… 2. ë°±ì—”ë“œë¡œ ë³´ë‚¼ ìµœì¢… JSON (Set ë…¸ë“œ ê²°ê³¼)\</b\>\</summary\>

ì´ JSONì´ `HTTP Request` ë…¸ë“œì˜ Bodyë¡œ ì „ì†¡ë©ë‹ˆë‹¤.

```json
{
  "title": "n8n ìë™í™” ì£¼ê°„ ë§Œì¡±ë„ ë¦¬í¬íŠ¸ (2025-10-29)",
  "items": [
    {
      "name": "ì´ ì‘ë‹µì ìˆ˜",
      "value": "308 ëª…"
    },
    {
      "name": "í˜„ì¬ NPS ì ìˆ˜",
      "value": "71.4 ì "
    },
    {
      "name": "--- ì§ë¬´ë³„ ì‘ë‹µ ë¶„í¬ ---",
      "value": "(ì´ 308ëª…)"
    },
    {
      "name": "ê°œë°œì",
      "value": "112ëª… (36.4%)"
    },
    {
      "name": "ë§¤ë‹ˆì €",
      "value": "75ëª… (24.4%)"
    },
    {
      "name": "ì„ì›",
      "value": "56ëª… (18.2%)"
    },
    {
      "name": "ê¸°íƒ€",
      "value": "65ëª… (21.1%)"
    },
    {
      "name": "--- ê¸°ì—… ê·œëª¨ë³„ ì‘ë‹µ ë¶„í¬ ---",
      "value": "(ì´ 308ëª…)"
    },
    {
      "name": "1-10ì¸",
      "value": "64ëª… (20.8%)"
    },
    {
      "name": "11-50ì¸",
      "value": "68ëª… (22.1%)"
    },
    {
      "name": "51-200ì¸",
      "value": "91ëª… (29.5%)"
    },
    {
      "name": "201ì¸ ì´ìƒ",
      "value": "85ëª… (27.6%)"
    }
  ]
}

```

\</details\>

### 3\. n8n ì›Œí¬í”Œë¡œìš° ìƒì„¸

`HTTP Request` ë…¸ë“œ(4ë‹¨ê³„)ì™€ `Telegram` ë…¸ë“œ(8ë‹¨ê³„) ì‚¬ì´ì— `AWS S3` ë…¸ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

#### 1\) n8nì— AWS Credentials ë“±ë¡
  * n8n ì™¼ìª½ ë©”ë‰´ì˜ 'Credentials'ë¡œ ì´ë™í•©ë‹ˆë‹¤.
  * 'Add Credential' \> 'AWS'ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
  * 13-1ì—ì„œ ë°œê¸‰ë°›ì€ `ì•¡ì„¸ìŠ¤ í‚¤ ID`ì™€ `ë¹„ë°€ ì•¡ì„¸ìŠ¤ í‚¤`ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.

#### 2\) AWS S3 ë…¸ë“œ ì„¤ì •
  * `HTTP Request` ë…¸ë“œ ë’¤ì— `AWS S3` ë…¸ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
  * **Credential:** ë°©ê¸ˆ ë“±ë¡í•œ AWS Credentialsì„ ì„ íƒí•©ë‹ˆë‹¤.
  * **Resource:** `Object`
  * **Operation:** `Get` (ê°€ì ¸ì˜¤ê¸°)
  * **Bucket Name:** `HTTP Request` ë…¸ë“œì˜ ê²°ê³¼ê°’ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.
      * `{{ $node["HTTP Request"].json.bucket }}`
  * **Key:** `HTTP Request` ë…¸ë“œì˜ ê²°ê³¼ê°’ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.
      * `{{ $node["HTTP Request"].json.key }}`
  * **Return:** `URL`
  * **[ì¤‘ìš”]** 'Return' ì˜µì…˜ì„ `URL`ë¡œ ì„¤ì •í•˜ë©´, n8nì´ S3 APIë¥¼ í˜¸ì¶œí•˜ì—¬ í•´ë‹¹ íŒŒì¼ì— ì¼ì • ì‹œê°„(ê¸°ë³¸ 15ë¶„) ë™ì•ˆë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” \*\*ì„ì‹œ ë³´ì•ˆ URL (Pre-signed URL)\*\*ì„ ìƒì„±í•´ ì¤ë‹ˆë‹¤.
  * ì´ ë…¸ë“œë¥¼ ì‹¤í–‰í•˜ë©´, `url`ì´ë¼ëŠ” í•„ë“œì— ì„ì‹œ URLì´ í¬í•¨ëœ JSON ë°ì´í„°ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

#### 3\) Telegram ë…¸ë“œ ì„¤ì • (ìˆ˜ì •ë¨)

  * `Telegram` ë…¸ë“œì—ì„œ ì „ì†¡í•  ë©”ì‹œì§€ ë‚´ìš©ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
  * **Text:**
      * (ê¸°ì¡´) `ì£¼ê°„ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! {{ $node["HTTP Request"].json.url }}`
      * **(ë³€ê²½)** `ì£¼ê°„ ë¦¬í¬íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (15ë¶„ê°„ ìœ íš¨) {{ $node["AWS S3"].json.url }}`
      * *ì°¸ì¡°í•˜ëŠ” ë…¸ë“œê°€ `HTTP Request`ì—ì„œ `AWS S3`ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.*
### 4\. ë°±ì—”ë“œ êµ¬í˜„ ì†ŒìŠ¤ (Full Code)

#### ğŸ’¡  ì™œ Puppeteerì¸ê°€ìš”?

13-1ì—ì„œ ì–¸ê¸‰í•œ 'ë¬´ê±°ìš´ ì‘ì—…'ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” `Puppeteer`ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„ íƒí•œ ì´ìœ ëŠ” ëª…í™•í•©ë‹ˆë‹¤.

**PuppeteerëŠ” 'í—¤ë“œë¦¬ìŠ¤ ë¸Œë¼ìš°ì €(Headless Browser)' ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.**

ì¦‰, ëˆˆì— ë³´ì´ëŠ” UI í™”ë©´(Head)ì´ ì—†ì„ ë¿, ë°±ê·¸ë¼ìš´ë“œì—ì„œ **ì‹¤ì œ Chromium ë¸Œë¼ìš°ì € ì—”ì§„**ì„ êµ¬ë™í•©ë‹ˆë‹¤.

1.  **ì™„ë²½í•œ ë Œë”ë§ (High-Fidelity):**
    `generateHtmlContent` í•¨ìˆ˜ë¡œ ë§Œë“  **HTMLê³¼ CSS** (í°íŠ¸, ìƒ‰ìƒ, ì—¬ë°±, ë ˆì´ì•„ì›ƒ ë“±)ë¥¼ ì‹¤ì œ í¬ë¡¬ ë¸Œë¼ìš°ì €ì—ì„œ ë³´ëŠ” ê²ƒê³¼ **100% ë™ì¼í•˜ê²Œ** ê·¸ë ¤ëƒ…ë‹ˆë‹¤. `jsPDF` ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì²˜ëŸ¼ PDF ì¢Œí‘œë¥¼ ê³„ì‚°í•  í•„ìš” ì—†ì´, ê°€ì¥ ìµìˆ™í•œ ì›¹ ê¸°ìˆ ë¡œ ë¦¬í¬íŠ¸ ë””ìì¸ì„ ì™„ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2.  **'ì¸ì‡„' ë°©ì‹ì˜ ì†ì‰¬ìš´ ë³€í™˜:**
    PuppeteerëŠ” ì´ë ‡ê²Œ ì™„ë²½í•˜ê²Œ ë Œë”ë§ëœ ì›¹í˜ì´ì§€ë¥¼ ê·¸ëŒ€ë¡œ 'ì¸ì‡„' ê¸°ëŠ¥ì²˜ëŸ¼ PDF íŒŒì¼ë¡œ 'ì°ì–´ëƒ…ë‹ˆë‹¤'. ì´ ë°©ì‹ì€ ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬(JavaScript)ê°€ ê·¸ë¦° ë™ì  ê·¸ë˜í”„ê¹Œì§€ë„ ê·¸ëŒ€ë¡œ PDFì— ë‹´ì„ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

3.  **'ë¬´ê±°ìš´ ì‘ì—…'ì˜ ì‹¤ì²´:**
    ì´ ê³¼ì •ì€ ì‹¤ì œ ë¸Œë¼ìš°ì €ë¥¼ í†µì§¸ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒê³¼ ê°™ì•„ì„œ ë©”ëª¨ë¦¬ì™€ CPU ìì›ì„ ë§ì´ ì†Œëª¨í•©ë‹ˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ n8n ì›Œí¬í”Œë¡œìš° ë‚´ë¶€ê°€ ì•„ë‹Œ **ë³„ë„ì˜ ë°±ì—”ë“œ ì„œë²„ë¡œ ë¶„ë¦¬í•œ í•µì‹¬ ì´ìœ **ì´ë©°, `Dockerfile`ì— `chromium`ê³¼ í•œê¸€ í°íŠ¸(`fonts-noto-cjk`)ë¥¼ ë°˜ë“œì‹œ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ” ì´ìœ ì…ë‹ˆë‹¤.

13ì°¨ì‹œ ì‹¤ìŠµìš© í´ë”ë¥¼ ë§Œë“¤ê³ , ì•„ë˜ 3ê°œ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

#### ì‹¤ì œ êµ¬í˜„ ì†ŒìŠ¤ ì‹œì‘

#### `package.json`

```json
{
  "name": "n8n-pdf-generator",
  "version": "1.0.0",
  "description": "Generates PDF reports for n8n workflows with S3 integration",
  "main": "server.js",
  "type": "module",
  "scripts": {
    "start": "node server.js",
    "dev": "node --watch server.js"
  },
  "engines": {
    "node": ">=20.0.0"
  },
  "dependencies": {
    "@aws-sdk/client-s3": "^3.709.0",
    "@fastify/cors": "^10.0.1",
    "fastify": "^5.2.0",
    "puppeteer": "^23.11.0"
  },
  "devDependencies": {
    "@types/node": "^22.10.2"
  }
}
```

#### `Dockerfile` (í•µì‹¬\!)

```dockerfile
# ===================================
# ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ: ì˜ì¡´ì„± ì„¤ì¹˜ ë‹¨ê³„
# ===================================
FROM node:20-slim AS dependencies

# Puppeteerê°€ Chromiumì„ ë‹¤ìš´ë¡œë“œí•˜ì§€ ì•Šë„ë¡ ì„¤ì • (ì‹œìŠ¤í…œ Chromium ì‚¬ìš©)
ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true

WORKDIR /usr/src/app

# package.json ë³µì‚¬ (ë ˆì´ì–´ ìºì‹± ìµœì í™”)
COPY package*.json ./

# í”„ë¡œë•ì…˜ ì˜ì¡´ì„±ë§Œ ì„¤ì¹˜
RUN npm install --omit=dev --ignore-scripts

# ===================================
# ìµœì¢… ëŸ°íƒ€ì„ ì´ë¯¸ì§€
# ===================================
FROM node:20-slim

# Chromium ë° í•„ìˆ˜ ì˜ì¡´ì„± ì„¤ì¹˜
RUN apt-get update \
    && apt-get install -y \
    chromium \
    ca-certificates \
    fonts-liberation \
    fonts-noto-color-emoji \
    fonts-noto-cjk \
    fonts-noto-cjk-extra \
    libappindicator3-1 \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libcups2 \
    libdbus-1-3 \
    libgbm1 \
    libglib2.0-0 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libxcomposite1 \
    libxdamage1 \
    libxrandr2 \
    xdg-utils \
    --no-install-recommends \
    && rm -rf /var/lib/apt/lists/*

# ë¹„ë£¨íŠ¸ ì‚¬ìš©ì ìƒì„± (ë³´ì•ˆ)
RUN groupadd -r appuser && useradd -r -g appuser -G audio,video appuser \
    && mkdir -p /home/appuser/Downloads \
    && chown -R appuser:appuser /home/appuser

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /usr/src/app

# ì˜ì¡´ì„± ë³µì‚¬
COPY --from=dependencies --chown=appuser:appuser /usr/src/app/node_modules ./node_modules

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì†ŒìŠ¤ ë³µì‚¬
COPY --chown=appuser:appuser . .

# ì‹œìŠ¤í…œ Chromium ê²½ë¡œ ì„¤ì •
ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium
ENV NODE_ENV=production
ENV PORT=8080

# ë¹„ë£¨íŠ¸ ì‚¬ìš©ìë¡œ ì „í™˜
USER appuser

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# í—¬ìŠ¤ì²´í¬ ì¶”ê°€
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD node -e "require('http').get('http://localhost:8080/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
CMD ["node", "server.js"]


```

#### `server.js` (S3 ì—…ë¡œë“œ ë¡œì§ ìˆ˜ì •ë¨)

n8nì— ê³µê°œ URL ëŒ€ì‹  S3 íŒŒì¼ í‚¤(Key)ë¥¼ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

```javascript
import Fastify from 'fastify';
import cors from '@fastify/cors';
import puppeteer from 'puppeteer';
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';
import { randomUUID } from 'crypto';

// ===================================
// í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
// ===================================
const requiredEnvVars = ['AWS_REGION', 'AWS_ACCESS_KEY_ID', 'AWS_SECRET_KEY', 'S3_BUCKET_NAME'];
const missingEnvVars = requiredEnvVars.filter(varName => !process.env[varName]);

if (missingEnvVars.length > 0) {
  console.error(`âŒ Missing required environment variables: ${missingEnvVars.join(', ')}`);
  process.exit(1);
}

// ===================================
// S3 í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
// ===================================
const s3Client = new S3Client({
  region: process.env.AWS_REGION,
  credentials: {
    accessKeyId: process.env.AWS_ACCESS_KEY_ID,
    secretAccessKey: process.env.AWS_SECRET_KEY,
  },
  // íƒ€ì„ì•„ì›ƒ ë° ì¬ì‹œë„ ì„¤ì •
  maxAttempts: 3,
  requestHandler: {
    requestTimeout: 30000, // 30ì´ˆ
  }
});

const S3_BUCKET_NAME = process.env.S3_BUCKET_NAME;
const PORT = parseInt(process.env.PORT || '8080', 10);
const NODE_ENV = process.env.NODE_ENV || 'development';

// ===================================
// Fastify ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
// ===================================
const fastify = Fastify({
  logger: {
    level: NODE_ENV === 'production' ? 'info' : 'debug',
    transport: NODE_ENV === 'development' ? {
      target: 'pino-pretty',
      options: {
        translateTime: 'HH:MM:ss Z',
        ignore: 'pid,hostname',
      }
    } : undefined,
  },
  requestTimeout: 60000, // 60ì´ˆ
  bodyLimit: 1048576, // 1MB
});

// CORS ì„¤ì •
await fastify.register(cors, {
  origin: true, // í”„ë¡œë•ì…˜ì—ì„œëŠ” íŠ¹ì • originë§Œ í—ˆìš©í•˜ë„ë¡ ë³€ê²½
});

// ===================================
// Puppeteer ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬
// ===================================
let browserInstance = null;

const getBrowser = async () => {
  if (!browserInstance || !browserInstance.connected) {
    fastify.log.info('ğŸš€ Launching new browser instance...');
    browserInstance = await puppeteer.launch({
      headless: true,
      args: [
        '--no-sandbox',
        '--disable-setuid-sandbox',
        '--disable-dev-shm-usage', // Docker í™˜ê²½ì—ì„œ ë©”ëª¨ë¦¬ ì´ìŠˆ ë°©ì§€
        '--disable-gpu',
        '--disable-software-rasterizer',
        '--disable-web-security', // ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹œ
        '--single-process', // ë©”ëª¨ë¦¬ ì ˆì•½
      ],
      executablePath: process.env.PUPPETEER_EXECUTABLE_PATH || undefined,
    });
  }
  return browserInstance;
};

// Graceful shutdown
const closeBrowser = async () => {
  if (browserInstance) {
    fastify.log.info('ğŸ”’ Closing browser instance...');
    await browserInstance.close();
    browserInstance = null;
  }
};

// ===================================
// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
// ===================================

/**
 * ìš”ì²­ ë°ì´í„° ê²€ì¦
 */
const validateRequestData = (data) => {
  if (!data || typeof data !== 'object') {
    throw new Error('Request body must be a valid JSON object');
  }

  if (!Array.isArray(data.items)) {
    throw new Error('Request body must contain an "items" array');
  }

  return true;
};

/**
 * HTML ì½˜í…ì¸  ìƒì„±
 */
const generateHtmlContent = (data) => {
  const items = data.items
    .map(item => {
      const name = String(item.name || '').replace(/[<>]/g, '');
      const value = String(item.value || '').replace(/[<>]/g, '');
      return `<li><strong>${name}</strong>: ${value}</li>`;
    })
    .join('');

  const title = String(data.title || 'My Report').replace(/[<>]/g, '');
  const date = new Date().toLocaleDateString('ko-KR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  });

  return `
    <!DOCTYPE html>
    <html lang="ko">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>${title}</title>
        <style>
          @page {
            margin: 20mm;
          }
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          body {
            font-family: 'Noto Sans CJK KR', 'Noto Sans KR', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', 'Apple SD Gothic Neo', sans-serif;
            padding: 40px;
            background: #fff;
            color: #333;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
          }
          h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
          }
          .date {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 30px;
          }
          ul {
            list-style: none;
            padding: 0;
          }
          li {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-left: 4px solid rgb(17, 171, 74);
            border-radius: 4px;
          }
          li strong {
            color: #2c3e50;
            font-weight: 600;
          }
          .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            text-align: center;
            color: #95a5a6;
            font-size: 12px;
          }
        </style>
      </head>
      <body>
        <h1>${title}</h1>
        <p class="date">ìƒì„±ì¼: ${date}</p>
        <ul>${items}</ul>
        <div class="footer">
          <p>Generated by n8n PDF Generator</p>
        </div>
      </body>
    </html>
  `;
};

/**
 * S3ì— PDF ì—…ë¡œë“œ
 */
const uploadToS3 = async (pdfBuffer, fileName) => {
  const uploadCommand = new PutObjectCommand({
    Bucket: S3_BUCKET_NAME,
    Key: fileName,
    Body: pdfBuffer,
    ContentType: 'application/pdf',
    Metadata: {
      'generated-at': new Date().toISOString(),
      'generator': 'n8n-pdf-generator'
    }
  });

  await s3Client.send(uploadCommand);
  return fileName;
};

// ===================================
// ë¼ìš°íŠ¸
// ===================================

/**
 * Health Check
 */
fastify.get('/health', async (request, reply) => {
  return {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    memory: process.memoryUsage(),
  };
});

/**
 * PDF ìƒì„± ë° S3 ì—…ë¡œë“œ
 */
fastify.post('/generate', async (request, reply) => {
  const startTime = Date.now();
  let page = null;

  try {
    // 1. ìš”ì²­ ë°ì´í„° ê²€ì¦
    validateRequestData(request.body);

    // 2. ë¸Œë¼ìš°ì € ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
    const browser = await getBrowser();
    page = await browser.newPage();

    // íƒ€ì„ì•„ì›ƒ ì„¤ì •
    page.setDefaultTimeout(30000);

    // 3. HTML ì½˜í…ì¸  ìƒì„± ë° ë Œë”ë§
    const html = generateHtmlContent(request.body);
    await page.setContent(html, { waitUntil: 'networkidle0' });

    // 4. PDF ìƒì„±
    const pdfBuffer = await page.pdf({
      format: 'A4',
      margin: {
        top: '20mm',
        right: '15mm',
        bottom: '20mm',
        left: '15mm'
      },
      printBackground: true,
      preferCSSPageSize: false,
    });

    // 5. í˜ì´ì§€ ë‹«ê¸° (ë©”ëª¨ë¦¬ í•´ì œ)
    await page.close();
    page = null;

    // 6. S3 ì—…ë¡œë“œ
    const fileName = `reports/${new Date().toISOString().split('T')[0]}/report-${randomUUID()}.pdf`;
    await uploadToS3(pdfBuffer, fileName);

    const duration = Date.now() - startTime;
    fastify.log.info(`âœ… PDF generated and uploaded in ${duration}ms`);

    // 7. ì‘ë‹µ ë°˜í™˜
    return {
      success: true,
      message: 'PDF generated and uploaded to S3',
      bucket: S3_BUCKET_NAME,
      key: fileName,
      size: pdfBuffer.length,
      duration: `${duration}ms`,
    };

  } catch (error) {
    // í˜ì´ì§€ê°€ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
    if (page) {
      try {
        await page.close();
      } catch (closeError) {
        fastify.log.error('Failed to close page:', closeError);
      }
    }

    fastify.log.error('âŒ PDF generation failed:', error);

    // ì—ëŸ¬ ìœ í˜•ë³„ ì‘ë‹µ
    const statusCode = error.message.includes('validation') ? 400 : 500;
    const errorResponse = {
      success: false,
      error: error.message,
      timestamp: new Date().toISOString(),
    };

    // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ í¬í•¨
    if (NODE_ENV === 'development') {
      errorResponse.stack = error.stack;
    }

    return reply.code(statusCode).send(errorResponse);
  }
});

/**
 * API ì •ë³´
 */
fastify.get('/', async () => {
  return {
    name: 'n8n PDF Generator API',
    version: '1.0.0',
    endpoints: {
      health: 'GET /health',
      generate: 'POST /generate',
    },
    documentation: {
      generate: {
        method: 'POST',
        path: '/generate',
        body: {
          title: 'string (optional)',
          items: [
            { name: 'string', value: 'string' }
          ]
        },
        response: {
          success: 'boolean',
          bucket: 'string',
          key: 'string',
          size: 'number',
          duration: 'string'
        }
      }
    }
  };
});

// ===================================
// ì„œë²„ ì‹œì‘ ë° Graceful Shutdown
// ===================================
const start = async () => {
  try {
    await fastify.listen({ port: PORT, host: '0.0.0.0' });
    fastify.log.info(`ğŸš€ Server listening on port ${PORT}`);
    fastify.log.info(`ğŸ“ Environment: ${NODE_ENV}`);
    fastify.log.info(`â˜ï¸  S3 Bucket: ${S3_BUCKET_NAME}`);
  } catch (err) {
    fastify.log.error(err);
    await closeBrowser();
    process.exit(1);
  }
};

// Graceful shutdown í•¸ë“¤ëŸ¬
const gracefulShutdown = async (signal) => {
  fastify.log.info(`${signal} received, shutting down gracefully...`);
  try {
    await fastify.close();
    await closeBrowser();
    process.exit(0);
  } catch (err) {
    fastify.log.error('Error during shutdown:', err);
    process.exit(1);
  }
};

process.on('SIGTERM', () => gracefulShutdown('SIGTERM'));
process.on('SIGINT', () => gracefulShutdown('SIGINT'));

// ì„œë²„ ì‹œì‘
start();


```


-----

## 13-3 Render ë°°í¬ (ì‰¬ìš´ PaaS)

### 1\. Renderë€? (Git-first)

**Render**ëŠ” Vercelì²˜ëŸ¼ GitHub ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì—°ê²°í•˜ë©´ ì½”ë“œë¥¼ ì•Œì•„ì„œ ë°°í¬í•´ ì£¼ëŠ” \*\*PaaS (Platform as a Service)\*\*ì…ë‹ˆë‹¤. "Git ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì—°ê²°í•˜ë©´ ì•Œì•„ì„œ í•´ì¤€ë‹¤"ëŠ” **"Git-first"** ì ‘ê·¼ ë°©ì‹ì´ë©°, ì…‹ì—…ì´ ê°€ì¥ ì‰½ìŠµë‹ˆë‹¤.

### 2\. Render ë°°í¬ ì ˆì°¨ (Dockerfile)

#### ğŸ’¡ RenderëŠ” Dockerfile ì—†ì´ë„ Node.jsë¥¼ ì§€ì›í•˜ì§€ ì•Šë‚˜ìš”?

ë„¤, ë§ìŠµë‹ˆë‹¤. RenderëŠ” `package.json`ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ Node.js í”„ë¡œì íŠ¸ë¡œ ì¸ì‹í•´ `npm install`ê³¼ `npm start`ë¥¼ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤.

í•˜ì§€ë§Œ 13ì°¨ì‹œ í”„ë¡œì íŠ¸ëŠ” `Dockerfile`ì´ **ì‚¬ì‹¤ìƒ í•„ìˆ˜**ì…ë‹ˆë‹¤.

ê·¸ ì´ìœ ëŠ” **Puppeteer**ê°€ ë‹¨ìˆœí•œ Node.js íŒ¨í‚¤ì§€ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. PuppeteerëŠ” PDFë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ OS ë ˆë²¨ì— **Chromium ë¸Œë¼ìš°ì €**ì™€ **í•œê¸€ í°íŠ¸(`fonts-noto-cjk`)** ì„¤ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

Renderì˜ ê¸°ë³¸ Node.js ëŸ°íƒ€ì„ í™˜ê²½ì—ëŠ” ì´ ë¸Œë¼ìš°ì €ì™€ í°íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. 13-2ì—ì„œ ì‘ì„±í•œ `Dockerfile`ì€ ë°”ë¡œ ì´ OS ì˜ì¡´ì„±ì„ `apt-get` ëª…ë ¹ìœ¼ë¡œ ì„¤ì¹˜í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

---
#### ë°°í¬ì ˆì°¨ 

RenderëŠ” ìš°ë¦¬ ë¦¬í¬ì§€í† ë¦¬ì˜ `Dockerfile`ì„ ë³´ê³  ì•Œì•„ì„œ "ì»¨í…Œì´ë„ˆ ë¹Œë“œ ë° ë°°í¬"ë¥¼ ì§„í–‰í•´ ì¤ë‹ˆë‹¤.

1.  13-2ì˜ 3ê°œ íŒŒì¼(`package.json`, `Dockerfile`, `server.js`)ì„ GitHub ë¦¬í¬ì§€í† ë¦¬ì— í‘¸ì‹œí•©ë‹ˆë‹¤.
2.  Render ê°€ì… í›„ "New" \> "Web Service"ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
3.  ë°©ê¸ˆ ìƒì„±í•œ GitHub ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
4.  Renderê°€ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. ì´ë•Œ **Runtimeì„ "Docker"ë¡œ ì„ íƒ**í•©ë‹ˆë‹¤.
5.  ì„œë¹„ìŠ¤ ì´ë¦„(e.g., `n8n-pdf-generator`)ì„ ì •í•©ë‹ˆë‹¤.
6.  **[ì¤‘ìš”]** 'Environment Variables'ë¡œ ì´ë™í•˜ì—¬ 13-1ì—ì„œ ë°œê¸‰ë°›ì€ S3 í‚¤ 3ê°œë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
      * `AWS_ACCESS_KEY_ID`: (13-1ì˜ í‚¤)
      * `AWS_SECRET_KEY`: (13-1ì˜ ë¹„ë°€ í‚¤)
      * `S3_BUCKET_NAME`: (13-1ì˜ ë²„í‚· ì´ë¦„)
      * `AWS_REGION`: ap-northeast-2
7.  "Create Web Service"ë¥¼ í´ë¦­í•˜ë©´ ë°°í¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤.
8.  ëª‡ ë¶„ í›„, `https://n8n-pdf-generator.onrender.com` ê°™ì€ ê³ ìœ  URLì´ ìƒì„±ë©ë‹ˆë‹¤.
9.  n8n ì›Œí¬í”Œë¡œìš°(13-2 ì‹œë‚˜ë¦¬ì˜¤)ì˜ `HTTP Request` ë…¸ë“œì— ì´ URLì„ ë„£ê³  í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

#### í…ŒìŠ¤íŠ¸ 

##### 1\) Health Check í…ŒìŠ¤íŠ¸ (GET)

ë¨¼ì € `/health` ì—”ë“œí¬ì¸íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
# [YOUR_RENDER_URL] ë¶€ë¶„ì„ ë³¸ì¸ì˜ Render URLë¡œ ë³€ê²½í•˜ì„¸ìš”.
curl https://n8n-pdf-generator.onrender.com/health
```

**âœ… ì •ìƒ ì‘ë‹µ ì˜ˆì‹œ:**

```json
{
  "status": "ok",
  "timestamp": "2025-10-30T10:00:00.000Z",
  "uptime": 120.5,
  "memory": { ... }
}
```

##### 2\) PDF ìƒì„± í…ŒìŠ¤íŠ¸ (POST)

`server.js`ì— ì •ì˜ëœ API ëª…ì„¸ì— ë”°ë¼ `/generate` ì—”ë“œí¬ì¸íŠ¸ì— JSON ë°ì´í„°ë¥¼ POSTë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

```bash
# [YOUR_RENDER_URL] ë¶€ë¶„ì„ ë³¸ì¸ì˜ Render URLë¡œ ë³€ê²½í•˜ì„¸ìš”.
# Windows CMDì—ì„œëŠ” ì¤„ ë°”ê¿ˆ(\)ì„ ë¹¼ê³  í•œ ì¤„ë¡œ ì…ë ¥í•˜ê±°ë‚˜, 
# JSON ë¶€ë¶„ë§Œ "..."ë¡œ ê°ì‹¸ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

curl -X POST 'https://n8n-pdf-generator.onrender.com/generate' \
-H 'Content-Type: application/json' \
-d '{
  "title": "cURL í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸",
  "items": [
    { "name": "í…ŒìŠ¤íŠ¸ í•­ëª© 1", "value": "ê°’ A" },
    { "name": "í…ŒìŠ¤íŠ¸ í•­ëª© 2", "value": "ê°’ B" }
  ]
}'
```

**âœ… ì •ìƒ ì‘ë‹µ ì˜ˆì‹œ:**

S3ì— íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ê³  ì‘ë‹µì„ ë°›ìœ¼ë©´ ì„±ê³µì…ë‹ˆë‹¤. (ì•½ 5\~10ì´ˆ ì •ë„ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)

```json
{
  "success": true,
  "message": "PDF generated and uploaded to S3",
  "bucket": "n8n-reports-pdf-myname",
  "key": "reports/2025-10-30/report-a1b2c3d4-....pdf",
  "size": 12345,
  "duration": "7890ms"
}
```

-----

## 13-4 GCP Cloud Run ë°°í¬ (ê°•ë ¥í•œ CaaS)

### 1\. Cloud Runì´ë€? (Container-first)

**GCP Cloud Run**ì€ **CaaS (Container as a Service)** ë˜ëŠ” 'ì„œë²„ë¦¬ìŠ¤ ì»¨í…Œì´ë„ˆ'ì…ë‹ˆë‹¤. Renderì™€ ë‹¬ë¦¬ "Git ë¦¬í¬ì§€í† ë¦¬"ê°€ ì•„ë‹Œ "ë¹Œë“œëœ **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€**"ë¥¼ ë°°í¬í•©ë‹ˆë‹¤.

"ì´ë¯¸ ë¹Œë“œëœ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ ì‹¤í–‰í•œë‹¤"ëŠ” **"Container-first"** ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤. ë” ë³µì¡í•˜ì§€ë§Œ, ë” ì €ë ´í•˜ê³  ê°•ë ¥í•˜ë©° OS í™˜ê²½ì„ ì™„ë²½í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2\. Cloud Run ë°°í¬ ì ˆì°¨
> **ê³µì‹ ë¬¸ì„œ í™•ì¸ (2025-10-30 ê¸°ì¤€)**:
>
>   - [Cloud Run Continuous Deployment](https://cloud.google.com/run/docs/continuous-deployment) â€“ Connect to repo + Docker ì§€ì›.
>   - [Build containers](https://cloud.google.com/run/docs/building/containers) â€“ Dockerfile ì‚¬ìš© ì‹œ cloudbuild.yaml í•„ìš”.
>   - **ë³€ê²½ì **: 2025ë…„ë¶€í„° Buildpacks ê¸°ë³¸, Docker ì„ íƒ ì‹œ íŠ¸ë¦¬ê±° ìë™ ìµœì í™”.

#### ğŸ¯ ì‚¬ì „ ì¤€ë¹„

##### í•„ìš”í•œ ë„êµ¬

  - Google Cloud SDK (gcloud CLI)
  - GitHub ê³„ì •
  - AWS S3 ë²„í‚· ë° ìê²©ì¦ëª… (13-1ì—ì„œ ì¤€ë¹„ë¨)
  - Docker (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©)

##### gcloud CLI ì„¤ì¹˜ ë° ì´ˆê¸°í™”

**macOS:**

```bash
brew install google-cloud-sdk
```

**Linux/Windows:** ê³µì‹ ë‹¤ìš´ë¡œë“œ.

```bash
gcloud init
gcloud auth login
gcloud config set project YOUR_PROJECT_ID  # ì˜ˆ: pearlplaygroud
```

-----

#### ğŸ”§ GCP í”„ë¡œì íŠ¸ ì„¤ì •

##### 1\. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± (ì„ íƒì‚¬í•­)

```bash
gcloud projects create pearlplaygroud --name="n8n PDF Generator"
gcloud config set project pearlplaygroud
```

##### 2\. í•„ìš”í•œ API í™œì„±í™”

```bash
gcloud services enable run.googleapis.com cloudbuild.googleapis.com containerregistry.googleapis.com secretmanager.googleapis.com artifactregistry.googleapis.com
```

##### 3\. í”„ë¡œì íŠ¸ ID í™•ì¸

```bash
export PROJECT_ID=$(gcloud config get-value project)
echo $PROJECT_ID
```

-----

#### ğŸ” Custom SA ìƒì„±

Legacy SA ëŒ€ì‹  ì‚¬ìš©ì ì§€ì • SA ì‚¬ìš© (ë³´ì•ˆ ê°•í™”).

```bash
SA_NAME="my-cloudbuild-sa"
SA_EMAIL="${SA_NAME}@${PROJECT_ID}.iam.gserviceaccount.com"

# SA ìƒì„±
gcloud iam service-accounts create $SA_NAME --display-name="Custom Cloud Build SA"

# ê¶Œí•œ ë¶€ì—¬
gcloud projects add-iam-policy-binding $PROJECT_ID --member="serviceAccount:$SA_EMAIL" --role="roles/cloudbuild.builds.builder"
gcloud projects add-iam-policy-binding $PROJECT_ID --member="serviceAccount:$SA_EMAIL" --role="roles/artifactregistry.writer"
gcloud projects add-iam-policy-binding $PROJECT_ID --member="serviceAccount:$SA_EMAIL" --role="roles/run.admin"
gcloud projects add-iam-policy-binding $PROJECT_ID --member="serviceAccount:$SA_EMAIL" --role="roles/secretmanager.secretAccessor"
gcloud projects add-iam-policy-binding $PROJECT_ID --member="serviceAccount:$SA_EMAIL" --role="roles/logging.logWriter"
```

**ì½˜ì†” í™•ì¸**:
IAM â†’ ì„œë¹„ìŠ¤ ê³„ì • â†’ `my-cloudbuild-sa` ê²€ìƒ‰.

-----

#### ğŸ” Secret Manager ì„¤ì •

13-1ì˜ AWS ìê²©ì¦ëª…(S3 í‚¤)ì„ GCP Secret Managerì— ì €ì¥í•©ë‹ˆë‹¤. Cloud Runì´ ì´ í‚¤ë“¤ì„ í™˜ê²½ ë³€ìˆ˜ì²˜ëŸ¼ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

```bash
# 13-1ì—ì„œ ë°œê¸‰ë°›ì€ í‚¤ë¡œ êµì²´
echo -n "YOUR_AWS_ACCESS_KEY_ID" | gcloud secrets create PDF_AWS_ACCESS_KEY_ID --data-file=-
echo -n "YOUR_AWS_SECRET_KEY" | gcloud secrets create PDF_AWS_SECRET_KEY --data-file=-
echo -n "YOUR_BUCKET_NAME" | gcloud secrets create PDF_S3_BUCKET_NAME --data-file=-
```

**Custom SAì— ê¶Œí•œ ë¶€ì—¬**: ìœ„ì—ì„œ ì´ë¯¸ `roles/secretmanager.secretAccessor` ë¶€ì—¬ë¨.

-----

#### ğŸš€ ìˆ˜ë™ ë°°í¬ (ì„ íƒì‚¬í•­: ìë™í™” ì „ ìµœì´ˆ í…ŒìŠ¤íŠ¸)

ìë™ ë°°í¬ ì„¤ì • ì „, ì´ë¯¸ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ ìˆ˜ë™ìœ¼ë¡œ ë¨¼ì € ë°°í¬í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

##### 1\. Docker ì´ë¯¸ì§€ ë¹Œë“œ

```bash
# 13-2ì˜ Dockerfileì´ ìˆëŠ” í´ë” (survey_backend)
cd survey_backend
docker build -t asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:v1 .

# mac ì‹¤ë¦¬ì½˜(M1 ~ M5) ì˜ ê²½ìš°
docker buildx build --platform linux/amd64 -t asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:v1 .
```

##### 2\. Artifact Registry í‘¸ì‹œ

ë¨¼ì € ë¦¬í¬ì§€í† ë¦¬ ìƒì„±:

```bash
gcloud artifacts repositories create my-repo --repository-format=docker --location=asia-northeast3
```

í‘¸ì‹œ:

```bash
gcloud auth configure-docker asia-northeast3-docker.pkg.dev
docker push asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:v1
```

##### 3\. Cloud Runì— ë°°í¬

```bash
gcloud run deploy n8n-pdf-generator \
  --image asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:v1 \
  --region asia-northeast3 \
  --platform managed \
  --allow-unauthenticated \
  --memory 1Gi \
  --cpu 1 \
  --min-instances 0 \
  --max-instances 10 \
  --timeout 60s \
  --service-account=$SA_EMAIL \
  --set-env-vars NODE_ENV=production,TZ=Asia/Seoul,AWS_REGION=ap-northeast-2 \
  --set-secrets AWS_ACCESS_KEY_ID=PDF_AWS_ACCESS_KEY_ID:latest,AWS_SECRET_KEY=PDF_AWS_SECRET_KEY:latest,S3_BUCKET_NAME=PDF_S3_BUCKET_NAME:latest
```

-----

#### ğŸ¤– Connect to Repo ì„¤ì • (ìë™ ë°°í¬)

##### 1\. GitHub ì €ì¥ì†Œì— ì½”ë“œ í‘¸ì‹œ

13-2ì˜ 3ê°œ íŒŒì¼(`package.json`, `Dockerfile`, `server.js`)ì„ GitHub ë¦¬í¬ì§€í† ë¦¬(`survey_backend` ë“±) ë£¨íŠ¸ì— í‘¸ì‹œí•©ë‹ˆë‹¤.

##### 2\. Cloud Build Repository ì—°ê²° (ìµœì´ˆ 1íšŒ ì„¤ì •)

Cloud Runì˜ "Connect to Repo" ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ì „ì—, GCP í”„ë¡œì íŠ¸ê°€ GitHub ê³„ì •(ë˜ëŠ” ì¡°ì§)ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ **ìµœì´ˆ 1íšŒ** ì—°ê²° ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1.  **Cloud Build ì½˜ì†” ì´ë™**:
      * Cloud Build â†’ Repositoriesë¡œ ì´ë™í•˜ì—¬ **2nd gen** íƒ­ì„ ì„ íƒí•©ë‹ˆë‹¤.
2.  **í˜¸ìŠ¤íŠ¸ ì—°ê²° ìƒì„± (Create host connection)**:
      * **Source**: GitHub (ê¸°ë³¸ê°’ ìœ ì§€)
      * **Region**: `asia-northeast3` (ê°€ì´ë“œ ê¸°ì¤€)
      * **Connection name**: `elanvital-personal-github` (ë˜ëŠ” ì‹ë³„ ê°€ëŠ¥í•œ ì´ë¦„)
      * **Connect** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
3.  **GitHub ì¸ì¦**:
      * GitHub ì‚¬ì´íŠ¸ë¡œ ë¦¬ë””ë ‰ì…˜ë˜ë©´ `Authorize Google Cloud Build`ë¥¼ ìŠ¹ì¸í•©ë‹ˆë‹¤.
      * ì„¤ì¹˜ ë²”ìœ„(Repository access)ë¥¼ ë¬»ëŠ” ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ë©´, ì´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  ì €ì¥ì†Œ(ì˜ˆ: `joosung80/survey_backend`)ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ì „ì²´ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.
4.  **ì €ì¥ì†Œ ì—°ê²° (Link repository)**:
      * ì¸ì¦ì´ ì™„ë£Œë˜ë©´ Cloud Build ì½˜ì†”ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.
      * **Link repository** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
      * **Connection**: ë°©ê¸ˆ ìƒì„±í•œ `elanvital-personal-github`ì„ ì„ íƒí•©ë‹ˆë‹¤.
      * **Repository**: ì—°ê²°í•  GitHub ì €ì¥ì†Œ (ì˜ˆ: `joosung80/survey_backend`)ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
      * **Link** ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì—°ê²°ì„ ì™„ë£Œí•©ë‹ˆë‹¤.

##### 3\. Connect to Repo ì„¤ì • (ì½˜ì†” ì¤‘ì‹¬)

1.  Cloud Run â†’ (ìˆ˜ë™ ë°°í¬ë¡œ ìƒì„±í•œ) `n8n-pdf-generator` â†’ **Connect to repo** í´ë¦­.
2.  **GitHub ì„ íƒ** â†’ `joosung80/survey_backend` (ê¸°ì¡´ ì—°ê²° ì¬ì‚¬ìš©).
3.  **Build type**: Dockerfile (Docker ìœ ì§€).
4.  **Dockerfile path**: `./Dockerfile` (ì €ì¥ì†Œ ë£¨íŠ¸ ê¸°ì¤€).
5.  **Connect** í´ë¦­ â†’ ìë™ íŠ¸ë¦¬ê±° ìƒì„±.

##### 4\. cloudbuild.yaml ì¶”ê°€ (ì €ì¥ì†Œ ë£¨íŠ¸, Docker ìœ ì§€ í•„ìˆ˜)

"Connect to Repo" ë°©ì‹ì´ `Dockerfile`ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ë ¤ë©´, ë¹Œë“œì™€ í‘¸ì‹œ ë‹¨ê³„ë¥¼ ëª…ì‹œí•œ `cloudbuild.yaml` íŒŒì¼ì´ ì €ì¥ì†Œ ë£¨íŠ¸ì— í•„ìš”í•©ë‹ˆë‹¤.

```yaml
# cloudbuild.yaml (Connect to Repo + Docker ì „ìš©)
# ë¹Œë“œ & í‘¸ì‹œë§Œ â†’ ë°°í¬ëŠ” Cloud Runì´ ìë™ ì²˜ë¦¬

steps:
  # 1. Docker ë¹Œë“œ
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - 'asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:$COMMIT_SHA'
      - '.'

  # 2. Artifact Registry í‘¸ì‹œ
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'push'
      - 'asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:$COMMIT_SHA'

# ìë™ ë°°í¬ìš© ì´ë¯¸ì§€ ì§€ì •
images:
  - 'asia-northeast3-docker.pkg.dev/$PROJECT_ID/my-repo/n8n-pdf-generator:$COMMIT_SHA'
```

ì´ì œ `git push`ë¥¼ ì‹¤í–‰í•˜ë©´ Cloud Buildê°€ ì´ `cloudbuild.yaml`ì„ ì½ì–´ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ ë° í‘¸ì‹œí•˜ê³ , Cloud Runì´ ìë™ìœ¼ë¡œ ìƒˆ ì´ë¯¸ì§€ë¡œ ë°°í¬(ë¡¤ë§ ì—…ë°ì´íŠ¸)ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.

-----

#### âœ… ë°°í¬ í™•ì¸ ë° í…ŒìŠ¤íŠ¸

##### 1\. Cloud Run ì„œë¹„ìŠ¤ í™•ì¸

```bash
export SERVICE_URL=$(gcloud run services describe n8n-pdf-generator --region asia-northeast3 --format 'value(status.url)')
echo $SERVICE_URL
```

**ì½˜ì†”**: Revisions íƒ­ â†’ ìƒˆ ë²„ì „ í™•ì¸.

##### 2\. API í…ŒìŠ¤íŠ¸ (n8nì—ì„œ)

n8n ì›Œí¬í”Œë¡œìš°(13-2 ì‹œë‚˜ë¦¬ì˜¤)ì˜ `HTTP Request` ë…¸ë“œì— ìœ„ì—ì„œ ì–»ì€ `$SERVICE_URL`ì„ ë„£ê³  `POST /generate`ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

##### 3\. ë¡œê·¸ í™•ì¸

```bash
gcloud logging tail "resource.type=cloud_run_revision AND resource.labels.service_name=n8n-pdf-generator"
```