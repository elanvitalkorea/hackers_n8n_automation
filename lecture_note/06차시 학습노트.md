
## 6-1 MCP 이해 

### MCP(Model Context Protocol) 의 정의 

- AI 애플리케이션과 외부 시스템을 연결하는 오픈 소스 표준(by Anthropic). 
- 🔌 **AI 앱을 위한 USB-C 포트**처럼 생각하면 이해하기 쉬움. 
	- USB-C가 다양한 기기를 표준으로 연결하는 구조와 비슷
- 기존의 REST API 가 AI Ecosystem안 에서는 MCP

### MCP 구성요소 

![hackers_6th_01](https://hackers-n8n-lecture.s3.ap-northeast-2.amazonaws.com/images/hackers_6th_01.png)														- Image credit by Figma

* **호스트 (Host)**
    * AI 모델 또는 애플리케이션 그 자체(Claude, Cursor)

* **클라이언트 (Client)**
    * 호스트(AI 모델)와 외부 시스템(서버)을 연결하는 중간 다리 역할

* **서버 (Server)**
    * 데이터베이스, 검색 엔진, 캘린더 등 AI가 연결하고자 하는 외부 시스템


### MCP가 탄생하게 된 배경

* **AI의 한계**
	- 기존의 AI 모델은 학습된 데이터 내에서만 작동하고, 실시간 정보나 외부 도구를 활용하는 데 제약
* **표준의 부재**
	- 각 LLM 에서 tool calling 방식을 제각각 개발함
	- N X M 문제 발생

![hackers_6th_02](https://hackers-n8n-lecture.s3.ap-northeast-2.amazonaws.com/images/hackers_6th_02.png)

* **개방형 생태계 구축**
	* 다양한 AI 애플리케이션과 외부 시스템이 자유롭게 상호작용할 수 있는 개방형 표준을 만들자는 목표

### MCP Server Component

![hackers_6th_03](https://hackers-n8n-lecture.s3.ap-northeast-2.amazonaws.com/images/hackers_6th_03.png)

- **Tools**: 
	- AI가 실제로 수행할 수 있는 행동들을 정의. 
	- 예를 들어, '주문하기'나 '검색하기' 같은 기능들이 포함.
	    
- **Resources**: 
	- AI가 참고할 수 있는 외부 데이터나 최신 정보를 제공
	- AI가 최신 메뉴 목록이나 실시간 재고 정보를 확인하는 데 사용.
	    
- **Prompts**: 
	- AI에게 주어진 역할과 대화의 목적, 행동 규칙을 설정하는 프롬프트.
	- 이를 통해 AI는 '친절한 카페 직원'과 같은 특정 역할을 수행.




#### 예시 시나리오: AI와 함께 '커피'를 주문하다 ☕

우리의 목표는 AI 챗봇을 통해 "카페라떼 2잔 주문해 줘"라고 말했을 때, AI가 이를 이해하고 주문을 완료하는 것입니다. 이 과정에서 MCP의 세 가지 핵심 요소가 어떻게 사용되는지 따라가 봅시다.

-----

##### 1\. Tools: AI의 '행동' 정의하기 🛠️

`Tools`는 AI가 직접 수행할 수 있는 행동입니다. AI가 "주문하기"라는 행동을 하려면, 우리는 이 기능을 미리 정의하고 등록해야 합니다.

**✅ 핵심 요약:**

  * **`Tool`의 역할**: AI가 외부 시스템(카페 주문 시스템)에 실제로 명령을 내릴 수 있도록 합니다.
  * **`description`의 중요성**: `description`은 AI에게 "이 도구는 어떤 용도로 사용되는지"를 알려주는 중요한 설명서입니다. 이 설명이 구체적이고 생생할수록 AI는 사용자의 의도를 정확히 파악하여 올바른 `Tool`을 호출합니다.

**Tool 스키마 등록 예시:**
**LLM에게 전달하는 설명 (자연어)**: 이 기능은 고객의 주문 요청을 받아 카페 시스템에 주문을 최종적으로 접수하는 데 사용돼요. 주문할 메뉴 이름과 수량을 꼭 알아야 해.

**JSON 스키마 (개발자용):**

```json
{
  "name": "place_order",
  "title": "카페 주문",
  "description": "사용자로부터 메뉴 이름과 수량을 입력받아 카페 주문을 최종적으로 처리하는 기능입니다.",
  "inputSchema": {
    "type": "object",
    "properties": {
      "menu_name": {
        "type": "string",
        "description": "주문할 커피 또는 음료의 이름입니다. (예: '아메리카노', '카페라떼')"
      },
      "quantity": {
        "type": "number",
        "description": "주문할 음료의 수량입니다. 1 이상의 정수여야 합니다."
      }
    },
    "required": ["menu_name", "quantity"]
  }
}
```

-----

##### 2\. Resources: AI에게 '배경 지식' 제공하기 📂

AI는 세상의 모든 정보를 알지 못합니다. 특히 우리 카페의 메뉴 목록은 최신 정보이므로, AI에게 이 정보를 `Resources`로 제공해야 합니다.

**✅ 핵심 요약:**

  * **`Resources`의 역할**: AI가 최신 데이터(메뉴 목록)를 참고하여 사용자의 요청을 정확히 이해하도록 돕습니다.
  * **`description`의 중요성**: `description`은 AI에게 "이 리소스는 어떤 종류의 정보가 담겨 있는지"를 알려줍니다. 이 설명이 명확해야 AI가 언제 이 정보를 읽어야 할지 판단할 수 있습니다.

**Resource 스키마 등록 예시:**
**LLM에게 전달하는 설명 (자연어)**: 이 리소스는 우리 카페의 현재 판매 중인 메뉴 목록과 가격 정보가 들어있어. 고객이 메뉴를 물어볼 때 참고하면 좋아.

**JSON 스키마 (개발자용):**

```json
{
  "uri": "file:///cafe/menu.json",
  "name": "cafe_menu.json",
  "title": "카페 메뉴 데이터",
  "mimeType": "application/json",
  "description": "현재 카페에서 판매 중인 모든 메뉴의 이름과 가격 정보가 담긴 파일입니다."
}
```

-----

##### 3\. Prompts: AI에게 '역할'과 '지시' 부여하기 ✍️

`Prompts`는 AI가 어떤 역할을 맡고, 어떤 방식으로 대화해야 할지 정의하는 템플릿입니다. AI는 이 프롬프트를 통해 "나는 친절한 카페 직원"이라는 역할을 부여받습니다.

**✅ 핵심 요약:**

  * **`Prompts`의 역할**: AI의 말투, 행동 규칙, 대화의 목적 등을 사전에 설정하여 일관된 경험을 제공합니다.
  * **`description`의 중요성**: `description`은 이 프롬프트가 어떤 대화 시나리오에 사용되는지를 알려줍니다. AI가 주어진 역할에 충실하게 행동하도록 유도합니다.

**Prompt 스키마 등록 예시:**
**LLM에게 전달하는 설명 (자연어)**: 이 프롬프트는 고객의 주문 요청을 처리하는 데 사용돼. 손님이 "주문해 줘"라고 말하면, 친절하고 정확하게 주문을 확인해 줘야 해.

**JSON 스키마 (개발자용):**

```json
{
  "name": "order_coffee_prompt",
  "title": "커피 주문 대화",
  "description": "친절한 카페 직원의 역할로, 고객의 커피 주문을 접수하고, 메뉴 이름과 수량을 확인하여 주문을 완료하는 대화 시나리오입니다.",
  "arguments": []
}
```

-----

##### 모든 요소가 통합된 실제 대화 흐름 🔄

![hackers_6th_04](https://hackers-n8n-lecture.s3.ap-northeast-2.amazonaws.com/images/hackers_6th_04.png)

```
sequenceDiagram
    participant User as 사용자
    participant Host as AI/LLM (호스트)
    participant Client as MCP 클라이언트
    participant Server as MCP 서버
    participant Cafe as 외부 카페 시스템

    User->>Host: "카페라떼 2잔 주문해 줘"

    Note over Host: (프롬프트/역할 적용) → 메뉴 확인 필요 판단

    Host->>Client: "메뉴 리소스 가져와줘"
    Client->>Server: 메뉴 리소스 요청
    Server-->>Client: 메뉴 데이터 제공
    Client-->>Host: 메뉴 데이터 전달

    Note over Host: '카페라떼' 확인 → 주문 실행 결정

    Host->>Client: "주문 도구 실행해줘(메뉴명, 수량)"
    Client->>Server: 주문 도구 실행 요청
    Server->>Cafe: 주문 생성 요청
    Cafe-->>Server: 주문 성공 응답
    Server-->>Client: 실행 결과 반환
    Client-->>Host: 실행 결과 전달

    Host-->>User: "따뜻한 카페라떼 두 잔 주문 접수되었습니다."

```


## 6-2 바이브코딩 MCP 기본 응용 

####  MCP 설정 방법
- cmd + shift + j 단축키
- Auto Run MCP Tools Protection Off 확인 
  ![hackers_6th_05](https://hackers-n8n-lecture.s3.ap-northeast-2.amazonaws.com/images/hackers_6th_05.png)
- MCP Tools 개별 Tool 항목 enable 가능 
- JSON 의 구성요소 설명

####  MCP 목록 찾기
- https://github.com/modelcontextprotocol/servers
- https://smithery.ai/

#### context7

- https://github.com/upstash/context7 참조
- ```
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp", "--api-key", "YOUR_API_KEY"]
    }
  ```
- https://context7.com/dashboard 에서 api key 생성 


react shadcn, tailwind 프로젝트 기초 설정해줘


#### sequential thinking
- https://github.com/modelcontextprotocol/servers/tree/main/src/sequentialthinking
- ```
    "sequential-thinking": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-sequential-thinking"
      ]
    }
  ```


## 6-3 바이브코딩 MCP 응용

### Supabase MCP
#### 설치 방법
- 토큰 설정 : supabase -> 프로필 -> Account Preferences -> Access Tokens -> Generate new token 
- project ref : 촤즉 상단 계정명 클릭시 프로젝트 리스트와 함께 ID 확인 가능 
- mcp 설정에서 readonly 설정 없는 것 확인
```
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--project-ref=your proejct"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "sbp_keyxxx"
      }
    },
```
#### Edge Function 만들기

참조 : https://www.youtube.com/watch?v=98bQdapCtq4

- edge function 
	- 프로젝트 당 100개, 월 50만회 호출 무료
	- gcp function, aws lambda 대신 쓸수도 있음
- recipe 정리
	- 생성 후 환경 변수에 openapi key 설정 
	- 발화
```
* Supabase MCP 서버를 사용하여 Edge Function을 배포
* 함수는 레시피 웹사이트 URL을 입력받아 OpenAI API로 내용 분석
* 레시피의 제목, 간단한 설명, 재료 목록, 조리법 단계를 추출
* 추출된 내용은 `title`, `description`, `ingredients`, `method`를 키로 갖는 JSON 형식으로 반환
```
- open ai key 발급 
	- https://platform.openai.com/api-keys
- edge function secret 에 와서 OPENAI_API_KEY 설정 
- 참조 요리법 사이트
	- https://www.taste.com.au/recipes/5-ingredient-ratatouille-rice-bake-recipe/aysntbg2?r=quickeasy
- rest client에 생성
	- edge function -> detail -> Invoke function 
	- rest client 로 변경해서 만들기 ( data -> url ) 
	  ``
```
curl -L -X POST 'https://xxx.supabase.co/functions/v1/extract-recipe'
-H 'Authorization: Bearer xxx.yyy.zzz'
-H 'Content-Type: application/json' \
--data '{"url":"실제 주소"}'
```

- table 에 저장
```
* Supabase Edge 함수를 업데이트하여 OpenAI의 응답을 데이터베이스에 저장하도록 수정
* Supabase에 `recipes`라는 이름의 신규 테이블 생성
* 테이블 컬럼은 `id`, `created_at`, `description`, `ingredients`, `method`로 구성
* `id`와 `created_at` 컬럼은 자동으로 값이 생성되도록 설정
```


### n8n MCP

#### n8n mcp github
https://github.com/czlonkowski/n8n-mcp
- 워크플로우 추천 및 생성 까지 가능 

```
    "n8n-mcp": {
      "command": "npx",
      "args": [
        "n8n-mcp"
      ],
      "env": {
        "MCP_MODE": "stdio",
        "LOG_LEVEL": "error",
        "DISABLE_CONSOLE_OUTPUT": "true",
        "N8N_API_URL": "https://your-url",
        "N8N_API_KEY": "n8nkeyxxx"
      }
    },
```

- API KEY :  Profile -> Settings-> n8n API 에서 셋업

#### claude desktop project 
- claude desktop mcp setup 
- project를 만들어서 n8n 인스트럭션에 추가
- 예시 
	- `gmail 에 온 메일을 분석하여 사업 제안일경우 discord로 알림을 주는 워크플로우`
- 셋업 가이드 까지 알려줌 


## 6-4 MCP 제작 실습


프롬프트
```
use sequentialthinking 
- memo mcp 구현
- 간단한 메모 저장, 삭제 기능 
- nodejs vanilla es6 구현
- index.js 파일 하나로 간단하게 서버 구현
- resource 구현  
	- memo.json 파일에 메모 내용 저장
	- 추후 DB로 확장되는 것 염두 
	- resource를 tool에서 사용하는 것이 바람직  
- mcp server tool, resource, prompt 3대 요소가 모두 쓰이도록 함
- test client로 스펙 유효성 확인 필요
- mcp setting 
	- Node.js 경로: `which node` 명령으로 실제 경로 확인
	- 설정이 바로 가능한 json 설정 파일도 가이드  
	- 기존에 cursor mcp 셋팅 파일을 직접 건드리지 말고 가이드만 줄것
	- CWD 인자는 필요 없으며 소스에서 소스 경로를 통해서 현재 디렉토리 설정 
```

스펙문서 추가
	- https://modelcontextprotocol.io/specification/
	- https://github.com/modelcontextprotocol/typescript-sdk/
